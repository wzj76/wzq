# 一、接入 Platform 组件

- 资源拷贝

```shell
cd paohz-client/code
cp ../../duole_client_base/sdks/src/platform/doc/appconfig.json .
cp ../../duole_client_base/sdks/src/platform/doc/channels.txt .
cp ../../duole_client_base/sdks/src/platform/doc/distribute-android.sh .
cp ../../duole_client_base/sdks/src/platform/doc/build_config.sh .
```

- 配置文件：appconfig.json 
按照各产品的实际参数进行设置。
```json
{
    "app_name": "${DUOLE_APP_NAME}",
    "channel": "${DUOLE_CHANNEL}",
    "channel_group": "${DUOLE_CHANNEL_GROUP}",
    "app_bundleid": "${DUOLE_APP_BUNDLEID}",
    "app_version": "${DUOLE_APP_VERSION}",
    "app_version_code": "${DUOLE_APP_VERCODE}",
    "clientbase_version": "${CLIENTBASE_VERSION}",
    "cocos2dx_version": "${COCOS2DX-VERSION}",
    "bugly_version": "${BUGLY_VERSION}",
    "launcher_version": "${LAUNCHER_VERSION}",
    "webview_version": "${WEBVIEW_VERSION}",
    "login_version": "${LOGIN_VERSION}"
}
```
**特别注意：上述{}参数由打包脚本自行进行修改；**

- 渠道信息配置文件：channels.txt 
在channels.txt中增加渠道列表，一行一个；
    ```text
    7k7k
    guanwang
    oppo
    vivo
    ```    
- 打包脚本修改：distribute-android.sh 
一般，仅需要修改渠道组设置即可；
```shell
# 打包脚本；
# usage：
# sh distribute-android.sh debug
# sh distribute-android.sh release
APP_HOME="`pwd -P`"
BUILD_TOOLS_PATH=${APP_HOME}/../../duole_client_base/tools
# 参数设置
BUILD_MODE=${1}
CHANNEL_GROUP="duole"
# 发布
# -c yes 表示需要清理上次打包残留文件；
# -c no 表示不需要清理，直接打包（不推荐）；
sh ${BUILD_TOOLS_PATH}/duole_distribute.sh \
-m ${BUILD_MODE} -p android -g ${CHANNEL_GROUP} -c yes
```
- Android 工程设置

**修改app/build.gradle** 
```groovy
// sdks path:
String duole_sdks = "../../../../duole_client_base/sdks"
java.srcDirs = [
    "src/main/java",
    "${duole_sdks}/src/platform/android/java"
]
```

- iOS 工程设置
```
Build Settings->User Header Search Paths:
增加：
    $(SRCROOT)/../../../duole_client_base/sdks/src

```

**注意：需剔除原有渠道信息处理相关代码**

# 二、组件应用
## 读取配置
- C++ 读取
```C++
#include "common/AppConfig.hpp"
// 读取配置信息
APPCONFIG.print();
std::string _channel = APPCONFIG.getString("channel");
std::string _channel_group = APPCONFIG.getString("channel_group");
log("{");
log("  channel: %s", _channel.c_str());
log("  channel_group: %s", _channel_group.c_str());
log("}");
```
## 渠道信息获取
- C++ 读取
```C++
#include "platform/PlatformUtil.hpp"
// 读取配置信息
const char * pChannelId = duole::PlatformUtil::getChannelId();
```
- Java 读取
```java
import com.duole.common.PlatformUtil;
String channelId = PlatformUtil.getChannelId();
```

## 手动进行配置文件加密
修改 appconfig.json 相关内容后，执行加密脚本。
```shell
sh build_config.sh
```

